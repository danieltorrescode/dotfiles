#!/bin/bash

## chmod 744 -R /home/daniel/scripts
# #   rwx
# 0   000
# 1   001
# 2   010
# 3   011
# 4   100
# 5   101
# 6   110
# 7   111
# XF86_keyboard_symbols complete list:
# wiki.linuxquestions.org/wiki/XF86_keyboard_symbols
echo "###########################################"
echo "start"
date +'%d/%m/%Y %I:%M:%S'
echo "#######################################################"
echo "updating repositories and installing packages"
echo "#######################################################"
pacman -S --needed --noconfirm archlinux-keyring
pacman -Syu
pacman -S --needed --noconfirm base-devel curl htop wget stow screen wpa_supplicant dhclient
pacman -S --needed --noconfirm xorg xorg-xinit xf86-input-synaptics xf86-input-libinput xdo clang cmake 
pacman -S --needed --noconfirm gnu-free-fonts ttf-hack ttf-liberation ttf-ubuntu-font-family 
pacman -S --needed --noconfirm emacs vim vifm neofetch tmux bash-completion 
pacman -S --needed --noconfirm picom feh arandr playerctl pavucontrol pulseaudio 
pacman -S --needed --noconfirm bluez bluez-utils blueman pulseaudio-bluetooth 
pacman -S --needed --noconfirm dmenu slock zathura zathura-pdf-mupdf mpv imagemagick  
pacman -S --needed --noconfirm flameshot liferea lxappearance-gtk3 
pacman -S --needed --noconfirm python-pip python-virtualenv  
pacman -S --needed --noconfirm udisks2 udiskie acpi numlockx  
pacman -S --needed --noconfirm mutt rtorrent transmission-cli 
pacman -S --needed --noconfirm ufw gufw firejail apparmor lxc keepassxc 
pacman -S --needed --noconfirm pamixer brightnessctl xbacklight mpd mpc 
pacman -S --needed --noconfirm xdotool lsd bat dunst cronie 
pacman -S --needed --noconfirm rofi alacritty starship fzf ncdu  
pacman -S --needed --noconfirm zsh zsh-autosuggestions zsh-completions zsh-syntax-highlighting zsh-theme-powerlevel10k
pacman -S --needed --noconfirm docker docker-compose qemu-full virt-manager dnsmasq firefox  
pacman -S --needed --noconfirm bspwm sxhkd polybar hyprland

echo "###########################################"
echo "AMD drivers"
echo "###########################################"
lspci -k | grep VGA
pacman -S --needed --noconfirm xf86-video-amdgpu xf86-video-ati vulkan-radeon
pacman -S --needed --noconfirm libva-mesa-driver mesa-vdpau mesa mesa-demos dxvk-bin

echo "###########################################"
echo "working with systemctl and services"
echo "###########################################"
usermod -aG docker daniel
newgrp libvirt
usermod -aG libvirt daniel
pip install --upgrade pip

systemctl enable ufw
systemctl enable cronie.service
systemctl start cronie.service
systemctl disable libvirtd.service
systemctl disable docker.service
systemctl disable bluetooth.service


echo "###########################################"
echo "cloning and building packages"
echo "###########################################"

echo "***** cloning emacs config *****"
su daniel -c "git clone https://github.com/danieltorrescode/emacs.git /home/daniel/.emacs.d"

echo "***** cloning vim package manager Vundle *****"
su daniel -c "git clone https://github.com/VundleVim/Vundle.vim.git /home/daniel/.vim/bundle/Vundle.vim"

su daniel -c "git clone https://github.com/danieltorrescode/dotfiles.git /home/daniel/dotfiles"

cp /home/daniel/dotfiles/config/70-synaptics.conf /etc/X11/xorg.conf.d/70-synaptics.conf
# cp /home/daniel/dotfiles/config/20-amd-gpu.conf /etc/X11/xorg.conf.d/20-amd-gpu.conf
cp /home/daniel/dotfiles/config/power.rules  /etc/udev/rules.d/power.rules

su daniel -c "git clone https://github.com/danieltorrescode/st.git /home/daniel/st"
rm /home/daniel/st/config.h
make -C /home/daniel/st/
make -C /home/daniel/st/ clean install

echo "###########################################"
echo "coping and cloning config files"
echo "###########################################"

su daniel -c "mkdir  /home/daniel/.local/share/Trash"
su daniel -c "mkdir /home/daniel/backups/"
su daniel -c "cp -v ~/* /home/daniel/backups/"
su daniel -c "cp -v ~/.* /home/daniel/backups/"
su daniel -c "rm /home/daniel/.bash_profile"

su daniel -c "stow shell config"
su daniel -c "chmod 744 -R /home/daniel/scripts"
su daniel -c "sed -i '/daniel torres/,$d' /home/daniel/.bashrc"
su daniel -c "cat /home/daniel/.bashrc_tail >> /home/daniel/.bashrc"

su daniel -c "chmod 774 /home/daniel/.config/bspwm/bspwmrc"
su daniel -c "chmod 774 /home/daniel/.config/sxhkd/sxhkdrc"
su daniel -c "chmod 774 /home/daniel/.config/polybar/launch.sh"

echo "#######################################################"
echo "installing paru"
echo "#######################################################"
pacman -S --needed --noconfirm go
su daniel -c "git clone https://aur.archlinux.org/paru.git /home/daniel/paru"
chown -R  daniel:daniel /home/daniel/paru
cd /home/daniel/paru
echo "run: makepkg -si"
echo "then run: paru --version"
su daniel

rm -rf /dotfiles

echo "###########################################"
echo "end"
date +'%d/%m/%Y %I:%M:%S'
echo "###########################################"
exit
